---
interface Props {
  textToCopy: string;
}

const { textToCopy } = Astro.props;
---

<button 
  id="copyButton"
  class="btn btn-success shadow-md border border-green-500"
>
  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
  </svg>
  Copiar IP
</button>

<script define:vars={{ textToCopy }}>
  document.addEventListener('DOMContentLoaded', () => {
    const copyButton = document.getElementById('copyButton');
    
    function copyTextToClipboard(text) {
      const textArea = document.createElement('textarea');
      textArea.value = text;
      textArea.style.position = 'fixed';
      textArea.style.top = '0';
      textArea.style.left = '0';
      textArea.style.width = '2em';
      textArea.style.height = '2em';
      textArea.style.padding = '0';
      textArea.style.border = 'none';
      textArea.style.outline = 'none';
      textArea.style.boxShadow = 'none';
      textArea.style.background = 'transparent';
      
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();
      
      let successful = false;
      try {
        successful = document.execCommand('copy');
      } catch (err) {
        console.error('No se pudo copiar el texto');
      }
      
      document.body.removeChild(textArea);
      return successful;
    }
    
    copyButton.addEventListener('click', () => {
      const originalContent = copyButton.innerHTML;
      
      try {
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(textToCopy)
            .then(() => {
              showCopiedMessage();
            })
            .catch(() => {
              if (copyTextToClipboard(textToCopy)) {
                showCopiedMessage();
              }
            });
        } else {
          if (copyTextToClipboard(textToCopy)) {
            showCopiedMessage();
          }
        }
      } catch (e) {
        if (copyTextToClipboard(textToCopy)) {
          showCopiedMessage();
        }
      }
      
      function showCopiedMessage() {
        copyButton.innerHTML = `<svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>Â¡Copiado!`;
        
        setTimeout(() => {
          copyButton.innerHTML = originalContent;
        }, 3000);
      }
    });
  });
</script>
